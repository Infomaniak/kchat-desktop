stages:
  - release

changelog:
  stage: release
  image: registry.infomaniak.com:443/leopold.jacquot/debian-toolbox:0.0.1
  needs:
    - build_docker_image
  environment:
    name: "$DEPLOY_VARIABLE"
  rules:
    - if: $DEPLOY_VARIABLE == "prod"
      when: on_success
    - if: $DEPLOY_VARIABLE == "preprod"
      when: on_success
    - when: never
  script:
    - "./release.sh ${GITLAB_API_TOKEN} ${CI_COMMIT_TAG} ${CI_COMMIT_TAG:0:3} ${SLACK_API_TOKEN} ${SLACK_NOTIFY_CHANNEL}"